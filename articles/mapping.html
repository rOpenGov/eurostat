<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="eurostat">
<title>Mapping Regional Data, Mapping Metadata Problems • eurostat</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto_Mono-0.4.5/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mapping Regional Data, Mapping Metadata Problems">
<meta property="og:description" content="eurostat">
<meta property="og:image" content="https://ropengov.github.io/eurostat/logo.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@rOpenGov">
<meta name="twitter:site" content="@rOpenGov">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=B612+Mono&amp;display=swap" rel="stylesheet">
<!-- rogtemplate style sheet --><link href="../BS5/rogtemplate.css" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">eurostat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.7.15</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/blogposts.html">Blog posts</a>
    <a class="dropdown-item" href="../articles/cheatsheet.html">Cheat sheet: eurostat R package</a>
    <a class="dropdown-item" href="../articles/eurostat_tutorial.html">Tutorial for the eurostat R package</a>
    <a class="dropdown-item" href="../articles/mapping.html">Mapping Regional Data, Mapping Metadata Problems</a>
    <a class="dropdown-item" href="../articles/maps.html">Map examples for the eurostat R package</a>
    <a class="dropdown-item" href="../articles/publications.html">Publications using the eurostat R package</a>
    <a class="dropdown-item" href="../articles/vignette.html">Vignette for the eurostat R package</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rOpenGov/eurostat/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Mapping Regional Data, Mapping Metadata Problems</h1>
                        <h4 data-toc-skip class="author">Daniel Antal,
CFA</h4>
            
            <h4 data-toc-skip class="date">2023-03-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rOpenGov/eurostat/blob/HEAD/vignettes/articles/mapping.Rmd" class="external-link"><code>vignettes/articles/mapping.Rmd</code></a></small>
      <div class="d-none name"><code>mapping.Rmd</code></div>
    </div>

    
    
<p>The <a href="https://regions.dataobservatory.eu/" class="external-link">regions</a> package
offers tools two work with regional statistics. It is an offspring of
the <a href="https://ropengov.github.io/eurostat/">eurostat</a> package
of <a href="https://ropengov.org/" class="external-link">rOpenGov</a>, which offers data
search, download, manipulation and visualization for Eurostat’s <a href="https://ec.europa.eu/eurostat" class="external-link">European statistics</a>. While you
can use <a href="https://regions.dataobservatory.eu/" class="external-link">regions</a> for
any European regional statistics, and with a limited functionality, any
regional statistics from other parts of the world, this article provides
a combined use case for the two packages.</p>
<p>Eurostat’s main function for data access is <a href="https://ropengov.github.io/eurostat/reference/get_eurostat.html">get_eurostat()</a>,
but in this case we will use the more specific <a href="https://ropengov.github.io/eurostat/reference/get_eurostat_json.html">get_eurostat_json</a>
to avoid downloading unnecessary aspects of this data product. Let us
get a long-established regional dataset, the full-time equivalent (FTE)
R&amp;D workforce, in both sexes, in all sectors and all professional
positions, and limit our data to two years only:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_rd_personnel</span> <span class="op">&lt;-</span> <span class="fu">eurostat</span><span class="fu">::</span><span class="fu"><a href="../reference/get_eurostat_json.html">get_eurostat_json</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"rd_p_persreg"</span>,</span>
<span>  filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    sex <span class="op">=</span> <span class="st">"T"</span>,</span>
<span>    prof_pos <span class="op">=</span> <span class="st">"TOTAL"</span>,</span>
<span>    sectperf <span class="op">=</span> <span class="st">"TOTAL"</span>,</span>
<span>    unit <span class="op">=</span> <span class="st">"FTE"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">regional_rd_personnel</span> <span class="op">&lt;-</span> <span class="va">regional_rd_personnel</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2009"</span>, <span class="st">"2018"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We have saved this filtered datasets as
<code>regional_rd_personnel</code> in the <a href="https://regions.dataobservatory.eu/" class="external-link">regions</a> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"regional_rd_personnel"</span><span class="op">)</span></span></code></pre></div>
<p>We have quiet a few missing cases:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">regional_rd_personnel</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Mode   FALSE    TRUE </span></span>
<span><span class="co">#&gt; logical     673     283</span></span></code></pre></div>
<p>But this is not the only problem with the dataset.</p>
<div class="section level3">
<h3 id="choropleth-map">Choropleth Map<a class="anchor" aria-label="anchor" href="#choropleth-map"></a>
</h3>
<p>Let us try to place the data on a <code>ggplot2</code> map.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>Let us download a map with <a href="https://ropengov.github.io/eurostat/reference/get_eurostat_geospatial.html">get_eurostat_geospatial</a>.
We will use the <code>NUTS2016</code>, i.e., <code>year = 2016</code>,
which is the regional boundary definition set in 2016 and used in the
period 2018-2020. This is the most used definition in 2021.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_nuts_2</span> <span class="op">&lt;-</span> <span class="fu">eurostat</span><span class="fu">::</span><span class="fu"><a href="../reference/get_eurostat_geospatial.html">get_eurostat_geospatial</a></span><span class="op">(</span></span>
<span>  resolution <span class="op">=</span> <span class="st">"60"</span>,</span>
<span>  nuts_level <span class="op">=</span> <span class="st">"2"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2016</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: sf</span></span>
<span><span class="co">#&gt; sf at resolution 1:60 read from local file</span></span>
<span><span class="co">#&gt; Warning in eurostat::get_eurostat_geospatial(resolution = "60", nuts_level =</span></span>
<span><span class="co">#&gt; "2", : Default of 'make_valid' for 'output_class="sf"' will be changed in the</span></span>
<span><span class="co">#&gt; future (see function details).</span></span></code></pre></div>
<p>You should always join your data with the geometric information of
the regions starting from left with the map:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">indicator_with_map</span> <span class="op">&lt;-</span> <span class="va">map_nuts_2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">regional_rd_personnel</span>, by <span class="op">=</span> <span class="st">"geo"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in sf_column %in% names(g): Each row in `x` is expected to match at most 1 row in `y`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Row 1 of `x` matches multiple rows.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> If multiple matches are expected, set `multiple = "all"` to silence this</span></span>
<span><span class="co">#&gt;   warning.</span></span></code></pre></div>
<p>Huge parts of Europe are not covered, but the missing values are not
randomly missing. France went under a regional reform; Turkey and
Albania did not provide this data earlier. Ireland has no regional
statistics available.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">indicator_with_map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">values</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"dim grey"</span>, size <span class="op">=</span> <span class="fl">.1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"#FAE000"</span>, high <span class="op">=</span> <span class="st">"#00843A"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span>facets <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"R&amp;D Personnel &amp; Researchers"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"In all sectors, both sexes by NUTS 2 regions"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"\ua9 EuroGeographics for the administrative boundaries</span></span>
<span><span class="st">                \ua9 Tutorial and ready-to-use data on economy.dataobservatory.eu"</span>,</span>
<span>    fill <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">22</span>, <span class="fl">48</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mapping_files/figure-html/unnamed-chunk-5-1.png" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="missing-values-and-seemingly-missing-values">Missing Values and Seemingly Missing Values<a class="anchor" aria-label="anchor" href="#missing-values-and-seemingly-missing-values"></a>
</h3>
<p>Some of these problems are real missing data problems, but some of
them are coding problem. In other words, the data is there, but it is
not conforming the boundaries that you have on the <code>NUTS2016</code>
map. First we need to validate the geographical coding of the dataset.
This is the task of <a href="https://regions.dataobservatory.eu/reference/validate_nuts_regions.html" class="external-link">validate_nuts_regions()</a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">validated_indicator</span> <span class="op">&lt;-</span> <span class="fu">regions</span><span class="fu">::</span><span class="fu"><a href="https://regions.dataobservatory.eu/reference/validate_nuts_regions.html" class="external-link">validate_nuts_regions</a></span><span class="op">(</span><span class="va">regional_rd_personnel</span><span class="op">)</span></span></code></pre></div>
<p>If we validate the dataset, we will see many interesting metadata
observations.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">validation_summary_2016</span> <span class="op">&lt;-</span> <span class="va">validated_indicator</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">time</span>, <span class="va">.data</span><span class="op">$</span><span class="va">typology</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    observations <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    values_missing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    values_present <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    valid_present <span class="op">=</span> <span class="va">values_present</span> <span class="op">/</span> <span class="va">observations</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Even though the dataset is called <a href="https://appsso.eurostat.ec.europa.eu/nui/show.do?dataset=rd_p_persreg&amp;lang=en" class="external-link">R&amp;D
personnel and researchers by sector of performance, sex and NUTS 2
regions (rd_p_persreg)</a>, in fact, it contains data on country and
<code>NUTS1</code> levels. And it has data on non-EU countries that in
2009 were not part of the NUTS system.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">validation_summary_2016</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="st">"2009"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 6</span></span></span>
<span><span class="co">#&gt;   time  typology            observations values_missing values_present valid_p…¹</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2009  country                       28              1             27     0.964</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2009  non_eu_country                 7              2              5     0.714</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2009  non_eu_nuts_level_1            7              4              3     0.429</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2009  non_eu_nuts_level_2           10              5              5     0.5  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2009  nuts_level_1                 105             14             91     0.867</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2009  nuts_level_2                 265             49            216     0.815</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 2009  <span style="color: #BB0000;">NA</span>                            56              3             53     0.946</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable name ¹​valid_present</span></span></span></code></pre></div>
<p>The situation is not better in 2018:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">validation_summary_2016</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="st">"2018"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 6</span></span></span>
<span><span class="co">#&gt;   time  typology            observations values_missing values_present valid_p…¹</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2018  country                       28              0             28     1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2018  non_eu_country                 7              1              6     0.857</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2018  non_eu_nuts_level_1            7              1              6     0.857</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2018  non_eu_nuts_level_2           10              0             10     1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2018  nuts_level_1                 105             45             60     0.571</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2018  nuts_level_2                 265            113            152     0.574</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 2018  <span style="color: #BB0000;">NA</span>                            56             45             11     0.196</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable name ¹​valid_present</span></span></span></code></pre></div>
<p>The dataset is plagued with data that has no place in the
<code>NUTS2016</code> boundary definition, and therefore on a
<code>NUTS2016</code> map!</p>
<p>What are the non-conforming bits?</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">validated_indicator</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">.data</span><span class="op">$</span><span class="va">valid_2016</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="st">"geo"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   [1] "BA"        "BA"        "CN_X_HK"   "CN_X_HK"   "EA19"      "EA19"     </span></span>
<span><span class="co">#&gt;   [7] "EU27_2020" "EU27_2020" "EU28"      "EU28"      "FR2"       "FR2"      </span></span>
<span><span class="co">#&gt;  [13] "FR21"      "FR21"      "FR22"      "FR22"      "FR23"      "FR23"     </span></span>
<span><span class="co">#&gt;  [19] "FR24"      "FR24"      "FR25"      "FR25"      "FR26"      "FR26"     </span></span>
<span><span class="co">#&gt;  [25] "FR3"       "FR3"       "FR30"      "FR30"      "FR4"       "FR4"      </span></span>
<span><span class="co">#&gt;  [31] "FR41"      "FR41"      "FR42"      "FR42"      "FR43"      "FR43"     </span></span>
<span><span class="co">#&gt;  [37] "FR5"       "FR5"       "FR51"      "FR51"      "FR52"      "FR52"     </span></span>
<span><span class="co">#&gt;  [43] "FR53"      "FR53"      "FR6"       "FR6"       "FR61"      "FR61"     </span></span>
<span><span class="co">#&gt;  [49] "FR62"      "FR62"      "FR63"      "FR63"      "FR7"       "FR7"      </span></span>
<span><span class="co">#&gt;  [55] "FR71"      "FR71"      "FR72"      "FR72"      "FR8"       "FR8"      </span></span>
<span><span class="co">#&gt;  [61] "FR81"      "FR81"      "FR82"      "FR82"      "FR83"      "FR83"     </span></span>
<span><span class="co">#&gt;  [67] "FRA"       "FRA"       "HR02"      "HR02"      "HU10"      "HU10"     </span></span>
<span><span class="co">#&gt;  [73] "IE01"      "IE01"      "IE02"      "IE02"      "JP"        "JP"       </span></span>
<span><span class="co">#&gt;  [79] "KR"        "KR"        "LT00"      "LT00"      "NO01"      "NO01"     </span></span>
<span><span class="co">#&gt;  [85] "NO03"      "NO03"      "NO04"      "NO04"      "NO05"      "NO05"     </span></span>
<span><span class="co">#&gt;  [91] "PL1"       "PL1"       "PL11"      "PL11"      "PL12"      "PL12"     </span></span>
<span><span class="co">#&gt;  [97] "PL3"       "PL3"       "PL31"      "PL31"      "PL32"      "PL32"     </span></span>
<span><span class="co">#&gt; [103] "PL33"      "PL33"      "PL34"      "PL34"      "RU"        "RU"       </span></span>
<span><span class="co">#&gt; [109] "UKM2"      "UKM2"      "UKM3"      "UKM3"</span></span></code></pre></div>
<ul>
<li>Plenty of French units. France went under a regional administrative
reform, and we have data about its past, but not in the current
boundaries and coding.</li>
<li>To a lesser extent, we have the same problem with Poland and the
UK.</li>
<li>We have comparative data from Asia on country level, which ended up
in a regional dataset.</li>
<li>We have Norway, which is a member of the EEA, and from 2021 it is
officially part of the NUTS2021 system. They were nice to provide their
data consistently for the past.</li>
<li>We have aggregates like the entire EU or the eurozone.</li>
</ul>
</div>
<div class="section level3">
<h3 id="recoding-and-renaming">Recoding and Renaming<a class="anchor" aria-label="anchor" href="#recoding-and-renaming"></a>
</h3>
<p>The question is, can we save some of the French data? If the
boundaries of regions changed, then we cannot: somebody must reaggregate
the number of researchers who used to work in the newly defined region
back then, before the reform.</p>
<p>But in some cases, the regional boundaries did not change, only the
name and the code of the region, which is the task performed by <a href="https://regions.dataobservatory.eu/reference/recode_nuts.html" class="external-link">recode_nuts()</a>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recoded_indicator</span> <span class="op">&lt;-</span> <span class="va">regional_rd_personnel</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">regions</span><span class="fu">::</span><span class="fu"><a href="https://regions.dataobservatory.eu/reference/recode_nuts.html" class="external-link">recode_nuts</a></span><span class="op">(</span></span>
<span>    geo_var <span class="op">=</span> <span class="st">"geo"</span>, <span class="co"># your geograhical ID variable name</span></span>
<span>    nuts_year <span class="op">=</span> <span class="fl">2016</span> <span class="co"># change this for other definitions</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recoding_summary</span> <span class="op">&lt;-</span> <span class="va">recoded_indicator</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>typology_change <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Recoded"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">typology_change</span><span class="op">)</span>,</span>
<span>    yes <span class="op">=</span> <span class="st">"Recoded"</span>,</span>
<span>    no <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">typology_change</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">typology_change</span>, <span class="va">.data</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    values_missing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    values_present <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    pct <span class="op">=</span> <span class="va">values_present</span> <span class="op">/</span> <span class="op">(</span><span class="va">values_present</span> <span class="op">+</span> <span class="va">values_missing</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Let us take a look at the problems identified by
<code><a href="https://regions.dataobservatory.eu/reference/recode_nuts.html" class="external-link">regions::recode_nuts()</a></code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recoding_summary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   typology_change [6]</span></span></span>
<span><span class="co">#&gt;    typology_change        time  values_missing values_present   pct</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Not found in NUTS      2009               1             11 0.917</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Not found in NUTS      2018               1             11 0.917</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Recoded                2009              12             42 0.778</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Recoded                2018              32             22 0.407</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Used in NUTS 1999-2013 2009               1              7 0.875</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Used in NUTS 1999-2013 2018               8              0 0    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Used in NUTS 2006-2013 2009               0              5 1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Used in NUTS 2006-2013 2018               5              0 0    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Used in NUTS 2021-2021 2009               0              1 1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Used in NUTS 2021-2021 2018               1              0 0    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> unchanged              2009              64            334 0.839</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> unchanged              2018             158            240 0.603</span></span></code></pre></div>
<ul>
<li><p>We were able to recode quite a few data points to the
<code>NUTS2016</code> definition for the time of observation 2009 as
well as 2018. Sometimes we are recoding rows that have missing values,
which does not help that much: we know where the data should be, but it
is missing anyway. But particularly for the year 2009 we can save plenty
of data by recorded the obsolete coding.</p></li>
<li><p>We identify further problems. We have coding the that was used in
various time periods, but there is no clear recoding possibility,
because the regions boundaries have changed. To have the history of the
data, we would need to recalculate them, say, by adding up the R&amp;D
personnel from each settlement in the new regional boundary.</p></li>
</ul>
<p>The following non-empty cases were present in the dataset, just not
with the coding that we used in the 2018-2020 period (i.e., the
<code>NUTS2016</code> coding.) We are able to save 27 observations just
by fixing the regional codes!</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recoded_indicator</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">typology</span> <span class="op">==</span> <span class="st">"nuts_level_2"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">typology_change</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="co"># Keep only pairs where we actually save</span></span>
<span>    <span class="co"># non-missing observations</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">geo</span>, <span class="va">.data</span><span class="op">$</span><span class="va">code_2016</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="co"># We filter out cases of countries who</span></span>
<span>    <span class="co"># joined the NUTS system later</span></span>
<span>    <span class="va">.data</span><span class="op">$</span><span class="va">geo</span> <span class="op">!=</span> <span class="va">.data</span><span class="op">$</span><span class="va">code_2016</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 27 × 2</span></span></span>
<span><span class="co">#&gt;    geo   code_2016</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> FR21  FRF2     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> FR22  FRE2     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> FR23  FRD2     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> FR24  FRB0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> FR25  FRD1     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> FR26  FRC1     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> FR3   FRE1     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> FR30  FRE1     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> FR41  FRF3     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> FR42  FRF1     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 17 more rows</span></span></span></code></pre></div>
<p>So, let us do the trick: change the <code>geo</code> variable to
<code>code_2016</code>, which is, whenever there is an equivalent
<code>geo</code> code in the <code>NUTS2016</code> definition, the data
that you should have. Your original geo variable contains codes that
were used, for example, in the <code>NUTS2010</code> or
<code>NUTS2013</code> boundary definitions.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recoded_with_map</span> <span class="op">&lt;-</span> <span class="va">map_nuts_2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">recoded_indicator</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>geo <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">code_2016</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"geo"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning in sf_column %in% names(g): Each row in `x` is expected to match at most 1 row in `y`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Row 1 of `x` matches multiple rows.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> If multiple matches are expected, set `multiple = "all"` to silence this</span></span>
<span><span class="co">#&gt;   warning.</span></span></code></pre></div>
<p>Let us make our work visible by creating three observation
<code>type</code> variables:</p>
<ul>
<li>
<code>missing</code> which is not present in the dataset;</li>
<li>
<code>before</code> which were correctly coded before our
recoding;</li>
<li>
<code>after</code> which became visible after recoding.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_rd_personnel_recoded</span> <span class="op">&lt;-</span> <span class="va">recoded_indicator</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>geo <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">code_2016</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>values_2016 <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">values</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"typology"</span>, <span class="st">"typology_change"</span>, <span class="st">"code_2016"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span></span>
<span>    <span class="va">regional_rd_personnel</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prof_pos"</span>, <span class="st">"sex"</span>, <span class="st">"sectperf"</span>, <span class="st">"unit"</span>, <span class="st">"geo"</span>, <span class="st">"time"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">values_2016</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">values</span><span class="op">)</span> <span class="op">~</span> <span class="st">"missing"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">values</span><span class="op">)</span> <span class="op">~</span> <span class="st">"after"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"before"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Use of .data in tidyselect expressions was deprecated in tidyselect 1.2.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `"values"` instead of `.data$values`</span></span></code></pre></div>
<p>And let’s place it now on the map:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_nuts_2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">regional_rd_personnel_recoded</span>, by <span class="op">=</span> <span class="st">"geo"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="co"># remove completely missing cases</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"dim grey"</span>, size <span class="op">=</span> <span class="fl">.1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FAE000"</span>, <span class="st">"#007CBB"</span>, <span class="st">"grey70"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">T</span>, title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span>facets <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"R&amp;D Personnel &amp; Researchers"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"In all sectors, both sexes by NUTS 2 regions"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"\ua9 EuroGeographics for the administrative boundaries</span></span>
<span><span class="st">                \ua9 Daniel Antal, rOpenGov"</span>,</span>
<span>    fill <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.93</span>, <span class="fl">.7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">22</span>, <span class="fl">48</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in sf_column %in% names(g): Each row in `x` is expected to match at most 1 row in `y`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Row 1 of `x` matches multiple rows.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> If multiple matches are expected, set `multiple = "all"` to silence this</span></span>
<span><span class="co">#&gt;   warning.</span></span></code></pre></div>
<p><img src="mapping_files/figure-html/unnamed-chunk-11-1.png" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>We did improve our dataset, and this improvement would not have
worked with traditional imputation techniques very well. For example,
replacing the missing French data with the median value of Europe would
have created a huge bias in our dataset.</p>
<p>This example is a simplification. There are many territorial
typologies in use in Europe and globally, but the main takeaway is
clear: sub-national boundaries are changing very fast, and you must make
sure that you join datasets, or data with a map with the same boundary
definitions.</p>
</div>
<div class="section level2">
<h2 id="citations-and-related-work">Citations and related work<a class="anchor" aria-label="anchor" href="#citations-and-related-work"></a>
</h2>
<div class="section level4">
<h4 id="citing-the-data-sources">Citing the data sources<a class="anchor" aria-label="anchor" href="#citing-the-data-sources"></a>
</h4>
<p>Eurostat data: cite <a href="https://ec.europa.eu/eurostat/" class="external-link">Eurostat</a>.</p>
<p>Administrative boundaries: cite <a href="https://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/administrative-units-statistical-units" class="external-link">EuroGeographics</a>.</p>
</div>
<div class="section level4">
<h4 id="citing-the-eurostat-r-package">Citing the eurostat R package<a class="anchor" aria-label="anchor" href="#citing-the-eurostat-r-package"></a>
</h4>
<p>For main developers and contributors, see the <a href="https://ropengov.github.io/eurostat">package homepage</a>.</p>
<p>This work can be freely used, modified and distributed under the
BSD-2-clause (modified FreeBSD) license:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"eurostat"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Kindly cite the eurostat R package as follows:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   (C) Leo Lahti, Janne Huovari, Markus Kainu, Przemyslaw Biecek.</span></span>
<span><span class="co">#&gt;   Retrieval and analysis of Eurostat open data with the eurostat</span></span>
<span><span class="co">#&gt;   package. R Journal 9(1):385-392, 2017. doi: 10.32614/RJ-2017-019</span></span>
<span><span class="co">#&gt;   Package URL: http://ropengov.github.io/eurostat Article URL:</span></span>
<span><span class="co">#&gt;   https://journal.r-project.org/archive/2017/RJ-2017-019/index.html</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   @Article{,</span></span>
<span><span class="co">#&gt;     title = {Retrieval and Analysis of Eurostat Open Data with the eurostat Package},</span></span>
<span><span class="co">#&gt;     author = {Leo Lahti and Janne Huovari and Markus Kainu and Przemyslaw Biecek},</span></span>
<span><span class="co">#&gt;     journal = {The R Journal},</span></span>
<span><span class="co">#&gt;     volume = {9},</span></span>
<span><span class="co">#&gt;     number = {1},</span></span>
<span><span class="co">#&gt;     pages = {385--392},</span></span>
<span><span class="co">#&gt;     year = {2017},</span></span>
<span><span class="co">#&gt;     doi = {10.32614/RJ-2017-019},</span></span>
<span><span class="co">#&gt;     url = {https://doi.org/10.32614/RJ-2017-019},</span></span>
<span><span class="co">#&gt;   }</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="citing-the-regions-r-package">Citing the regions R package<a class="anchor" aria-label="anchor" href="#citing-the-regions-r-package"></a>
</h4>
<p>For main developer and contributors, see the <a href="https://regions.dataobservatory.eu/" class="external-link">package</a>.</p>
<p>This work can be freely used, modified and distributed under the
GPL-3 license:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"regions"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To cite package 'regions' in publications use:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Antal D (2021). _regions: Processing Regional Statistics_. R package</span></span>
<span><span class="co">#&gt;   version 0.1.8, &lt;https://regions.dataobservatory.eu/&gt;.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   @Manual{,</span></span>
<span><span class="co">#&gt;     title = {regions: Processing Regional Statistics},</span></span>
<span><span class="co">#&gt;     author = {Daniel Antal},</span></span>
<span><span class="co">#&gt;     year = {2021},</span></span>
<span><span class="co">#&gt;     note = {R package version 0.1.8},</span></span>
<span><span class="co">#&gt;     url = {https://regions.dataobservatory.eu/},</span></span>
<span><span class="co">#&gt;   }</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="contact">Contact<a class="anchor" aria-label="anchor" href="#contact"></a>
</h4>
<p>For contact information, see the <a href="https://ropengov.github.io/eurostat">package homepage</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="version-info">Version info<a class="anchor" aria-label="anchor" href="#version-info"></a>
</h2>
<p>This tutorial was created with</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.2.2 (2022-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.2 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3</span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] ggplot2_3.4.1   dplyr_1.1.0     eurostat_3.7.15 regions_0.1.8  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] Rcpp_1.0.10        lubridate_1.9.2    here_1.0.1         countrycode_1.4.0 </span></span>
<span><span class="co">#&gt;  [5] tidyr_1.3.0        class_7.3-20       assertthat_0.2.1   rprojroot_2.0.3   </span></span>
<span><span class="co">#&gt;  [9] digest_0.6.31      utf8_1.2.3         R6_2.5.1           cellranger_1.1.0  </span></span>
<span><span class="co">#&gt; [13] plyr_1.8.8         backports_1.4.1    evaluate_0.20      e1071_1.7-13      </span></span>
<span><span class="co">#&gt; [17] highr_0.10         httr_1.4.5         pillar_1.8.1       rlang_1.0.6       </span></span>
<span><span class="co">#&gt; [21] curl_5.0.0         readxl_1.4.2       jquerylib_0.1.4    rmarkdown_2.20    </span></span>
<span><span class="co">#&gt; [25] pkgdown_2.0.7      textshaping_0.3.6  desc_1.4.2         RefManageR_1.4.0  </span></span>
<span><span class="co">#&gt; [29] readr_2.1.4        stringr_1.5.0      ISOweek_0.6-2      munsell_0.5.0     </span></span>
<span><span class="co">#&gt; [33] proxy_0.4-27       broom_1.0.3        compiler_4.2.2     xfun_0.37         </span></span>
<span><span class="co">#&gt; [37] pkgconfig_2.0.3    systemfonts_1.0.4  htmltools_0.5.4    tidyselect_1.2.0  </span></span>
<span><span class="co">#&gt; [41] tibble_3.1.8       fansi_1.0.4        sf_1.0-9           withr_2.5.0       </span></span>
<span><span class="co">#&gt; [45] tzdb_0.3.0         grid_4.2.2         DBI_1.1.3          gtable_0.3.1      </span></span>
<span><span class="co">#&gt; [49] jsonlite_1.8.4     lifecycle_1.0.3    magrittr_2.0.3     units_0.8-1       </span></span>
<span><span class="co">#&gt; [53] scales_1.2.1       bibtex_0.5.1       KernSmooth_2.23-20 cli_3.6.0         </span></span>
<span><span class="co">#&gt; [57] stringi_1.7.12     cachem_1.0.7       farver_2.1.1       fs_1.6.1          </span></span>
<span><span class="co">#&gt; [61] xml2_1.3.3         bslib_0.4.2        ellipsis_0.3.2     ragg_1.2.5        </span></span>
<span><span class="co">#&gt; [65] generics_0.1.3     vctrs_0.5.2        tools_4.2.2        glue_1.6.2        </span></span>
<span><span class="co">#&gt; [69] purrr_1.0.1        hms_1.1.2          fastmap_1.1.1      yaml_2.3.7        </span></span>
<span><span class="co">#&gt; [73] colorspace_2.1-0   timechange_0.2.0   classInt_0.4-9     memoise_2.0.1     </span></span>
<span><span class="co">#&gt; [77] knitr_1.42         sass_0.4.5</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Leo Lahti, Janne Huovari, Markus Kainu, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

    <!-- Add ropengov logo -->
  <script src="../BS5/logo.js"></script>
</body>
</html>
